name: python-tests

on:
  push:
    branches: [main]
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python 3.13
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'

      - name: Show Python version
        run: |
          python --version

      # NOTE: The full pinned ML/quantum stack in requirements.txt may not have
      # Python 3.13 wheels available on ubuntu-latest. Unit tests are designed
      # to run without these optional dependencies (defensive imports + offline mode).
      - name: Install minimal dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install -r requirements-ci.txt

      - name: Run unit tests (offline)
        env:
          HF_HUB_OFFLINE: '1'
          TRANSFORMERS_OFFLINE: '1'
        run: |
          python -m compileall -q quantum_avatar
          python -m unittest discover -s quantum_avatar/tests -p "test_*.py"
